⎕IO ← 0

prefix ← {⍺←⍬ ⋄ 1≡≢⍵:⊃∧/(<∘⍵)¨⍺ ⋄ (∧/(<∘(⊃⍵))¨⍺),(⍺,⊃⍵)∇(1↓⍵)}
side ← {⍉↑prefix¨,⌿⍵}

view ← {x y ← ⍺ ⋄ val ← (y x)⌷⍵ ⋄ ×/ {⍬≡⍺:0 ⋄ (0≡⍺)∨(0≡⍵):1+⍺ ⋄ ⍺+⍵}/¨ {⍵≡⍬: 0 0 ⋄ ⍵}¨ <∘val¨ (⌽y↑x⌷[1]⍵) (⌽x↑y⌷⍵) ((1+x)↓y⌷⍵) ((1+y)↓x⌷[1]⍵)}
mask ← {n←¯2+≢⍵ ⋄ 1+⍸n n⍴1}

part1 ← {+/+/⊃ {a b c d ← ⍵ ⋄ ∨/ a (⍉b) (⊖c) (⍉⊖d)} side¨ {⍵ (⍉⍵) (⊖⍵) (⊖⍉⍵)} ⍎¨↑ ⍵}
part2 ← {⌈/ view∘⍵¨ mask ⍵} (⍎¨↑) 


data ← ⊃⎕NGET ⍞1
⎕ ← part1 data
⎕ ← part2 data
